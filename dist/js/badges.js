import{reformatOperator,convertNumberToLevel}from"./utils.js";const badgeImgs=Array.from(document.getElementsByClassName("badge-img"));async function getUserId(){try{return(await(await fetch("/user-id")).json()).userId}catch(e){throw console.error(e),e}}async function retrieveBadges(){try{var e=(await(await fetch("/get-badges")).json()).badges;return console.log("bages",e),e}catch(e){return console.error(e),{}}}function getHighestBadge(t){var a,r=[];for(a in t)for(var o in t[a]){let e=0;for(var n in t[a][o]){var s=Number(n);1==t[a][o][n]&&(e=Math.max(e,s))}r.push([a,o,String(e)])}return r}function updateBadgeAppearance(e,t){var a,t=getHighestBadge(t);console.log(t);for(a of t)if(0<Number(a[2]))for(var r of e){var o=r.getAttribute("data-badge-type"),n=r.getAttribute("data-badge-operator"),s=r.nextElementSibling;a[1]==o&&a[0]==n&&null!==n&&null!==o&&(console.log("best[1]",a[1],"best[0]",a[0],"type",o,"op",n),r.classList.add("active"),s)&&(s.textContent=convertNumberToLevel(Number(a[2])))}}async function updateBadgeStatus(e,t,a,r){a=reformatOperator(a);try{var o=await retrieveBadges();console.log("badges from DB",o),r&&(console.log("type:",e),o[a][e][t]=!0,await updateSessionAndDB(o))}catch(e){console.error(e)}}async function updateSessionAndDB(e){try{var t=await getUserId();t?(await fetch("/update-badges",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,updatedBadges:e})})).ok?(console.log("Badges updated successfully!"),console.log(e)):console.error("Error updating badges!"):console.error("Failed to retrieve user ID")}catch(e){console.error("There was a problem with the fetch operation:",e)}}async function initializeBadgeAppearance(){var e=await retrieveBadges();updateBadgeAppearance(badgeImgs,e)}window.addEventListener("DOMContentLoaded",initializeBadgeAppearance);export{retrieveBadges,getHighestBadge,updateBadgeAppearance,updateBadgeStatus};