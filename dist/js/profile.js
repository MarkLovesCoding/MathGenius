const modal=document.getElementById("avatar-modal"),profile=document.getElementById("profile-user-avatar"),span=document.getElementById("avatar-modal-close"),userIconsContainer=document.getElementById("avatar-user-icons");async function retrieveAvatar(e){try{var t=(await(await fetch("/get-avatar")).json()).avatarSrc.replace(/https?:\/\/[^\/]+/,"../");e.src=t}catch(e){console.error(e)}}async function handleUserIconClick(e){e=e.target.closest("img");e&&(profile.setAttribute("src",e.src),await updateSessionAndDB(e.src),modal.style.display="none")}async function getUserId(){try{return(await(await fetch("/user-id")).json()).userId}catch(e){throw console.error(e),e}}async function updateSessionAndDB(e){try{var t=await getUserId();t?(await fetch("/update-image",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,newSrc:e})})).ok?console.log("Image source updated successfully!"):console.error("Error updating image source!"):console.error("Failed to retrieve user ID")}catch(e){console.error("There was a problem with the fetch operation:",e)}}profile.onclick=function(){modal.style.display="flex",modal.style.justifyContent="center",modal.style.alignItems="center"},span.onclick=function(){modal.style.display="none"},window.onclick=function(e){e.target==modal&&(modal.style.display="none")},window.addEventListener("DOMContentLoaded",function(){retrieveAvatar(profile)}),userIconsContainer.addEventListener("click",handleUserIconClick);