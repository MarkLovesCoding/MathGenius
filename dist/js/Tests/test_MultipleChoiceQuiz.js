import*as utilMethods from"../utils.js";import{state}from"../state.js";import*as questionLogic from"../sharedQuestionLogic.js";import{updateBadgeStatus}from"../badges.js";import{animateBadge}from"../badgeEarned.js";const mcQuizOptions=document.getElementById("mc-quiz-options");function finishMCQuiz(){state.mcQuizActive.mcqNumAnswered=0,state.mcQuizActive.mcqNumCorrect=0,state.mcQuizActive.mcqFailedAttempts=0}const mcQuestionNumber=document.getElementById("mc-question-number"),mcQuestionsCorrect=document.getElementById("mc-questions-correct"),mcQuizModal=document.getElementById("mc-quiz-modal"),mcQuizAmountCorrect=document.getElementById("mc-quiz-amountCorrect"),mcQuizAmountCorrectPercentage=document.getElementById("mc-quiz-amountCorrectPercentage");async function mcQuizShowScore(){mcQuizAmountCorrect.textContent=state.mcQuizActive.mcqNumCorrect.toString(),mcQuizAmountCorrectPercentage.textContent=utilMethods.percentage(state.mcQuizActive.mcqNumCorrect,state.mcQuizActive.mcqNumAnswered).toString()+"%",mcQuizModal.style.visibility="visible",mcQuizModal.style.zIndex="101",utilMethods.emphasize(mcQuizModal),await utilMethods.delay(1600),mcQuizModal.style.visibility="hidden",mcQuizModal.style.zIndex="0"}function updateMCQuizPage(){var t=state.mcQuizActive.mcqNumCorrect,e=state.mcQuizActive.mcqNumAnswered;mcQuestionNumber.textContent=e.toString(),mcQuestionsCorrect.textContent=t.toString()}async function checkMCQAnswered(){if(state.mcQuizActive.mcqNumAnswered==state.mcQuizActive.mcqNumQuestion){if(10==state.mcQuizActive.mcqNumCorrect){var t=sessionStorage.getItem("activeDifficulty"),e=sessionStorage.getItem("activeOperators");if(await animateBadge(),!t||!e)throw new Error("Error retrieving diff and operator from session Storage");await updateBadgeStatus("mcquiz",t,e,!0)}else mcQuizShowScore();finishMCQuiz()}}async function mcQuizAnswerCheck(t,e,i=null){var c=sessionStorage.getItem("activeOperators");if(t){if(0===state.mcQuizActive.mcqFailedAttempts&&(state.mcQuizActive.mcqNumCorrect+=1,state.mcQuizActive.mcqNumAnswered+=1),0<state.mcQuizActive.mcqFailedAttempts&&(state.mcQuizActive.mcqNumAnswered+=1),state.mcQuizActive.mcqFailedAttempts=0,checkMCQAnswered(),utilMethods.animateCorrect(e),await utilMethods.delay(150),updateMCQuizPage(),!c)throw new Error("Error retrieving operator from session storage");questionLogic.newQuestion("multiple-choice-quiz",c,mcQuizCreateOptions)}else state.mcQuizActive.mcqFailedAttempts+=1,checkMCQAnswered(),i&&utilMethods.animateIncorrect(i),await utilMethods.delay(150),updateMCQuizPage()}function mcQuizCreateOptions(t,e,i){var c=utilMethods.createOptions(t,e,i);mcQuizOptions.innerHTML="";let o=utilMethods.calculation(t,e,i);c.forEach(t=>{var e=document.createElement("button");e.classList.add("option"),e.textContent=t.toString();let i;t==o&&(i=e),e.addEventListener("mousedown",function(t){t=t.target;t.textContent==o.toString()&&mcQuizAnswerCheck(!0,t),t.textContent!=o.toString()&&mcQuizAnswerCheck(!1,i,t)}),mcQuizOptions.appendChild(e)})}window.onload=function(){var t=sessionStorage.getItem("activeOperators"),e=sessionStorage.getItem("activeDifficulty");t&&e&&(utilMethods.updateGeneralSelected(t,e),questionLogic.newQuestion("multiple-choice-quiz",t,mcQuizCreateOptions))};export{mcQuizCreateOptions};