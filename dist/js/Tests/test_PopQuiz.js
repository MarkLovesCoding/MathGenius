import*as utilMethods from"../utils.js";import{state}from"../state.js";import*as questionLogic from"../sharedQuestionLogic.js";import{updateBadgeStatus}from"../badges.js";import{animateBadge}from"../badgeEarned.js";import{quizAmountCorrect,quizAmountCorrectPercentage,quizAnswerForm,quizAnswerInput,quizCorrectness,quizCurrQuestion,quizCurrScore,quizCurrScoreContainer,quizLastScore,quizLastScoreContainer,quizModal,quizNumOne,quizNumTwo,quizOpOne}from"../domElements.js";async function quizAnswerCheck(e){e?(utilMethods.emphasize(quizAnswerForm,50,1.1,150),utilMethods.correctnessView(!0,quizCorrectness)):(utilMethods.incorrectMotion(quizAnswerForm),utilMethods.correctnessView(!1,quizCorrectness)),utilMethods.disableInput(quizAnswerInput),addToQuizProperty(e,state.quizStats),checkQuizStatus(state.quizStats,quizCurrScoreContainer,quizLastScoreContainer,quizLastScore),await utilMethods.delay(700),utilMethods.enableInput(quizAnswerInput),utilMethods.resetAnswerInput([quizAnswerInput]),questionLogic.newQuestion("quiz",state.activeOperators,state)}async function quizShowScore(){quizAmountCorrect.textContent=state.quizStats.numCorrect,quizAmountCorrectPercentage.textContent=utilMethods.percentage(state.quizStats.numCorrect,state.quizStats.numAnswered).toString()+"%",quizModal.style.visibility="visible",quizModal.style.zIndex=101,utilMethods.emphasize(quizModal),await utilMethods.delay(1600),quizModal.style.visibility="hidden",quizModal.style.zIndex=0,utilMethods.enableInput(quizAnswerInput)}function resetQuizProperty(e){e.numAnswered=0,e.numCorrect=0}function updateQuizScores(e,t,i){e.innerHTML=i.numCorrect,t.innerHTML=i.numAnswered}function addToQuizProperty(e,t){t.numAnswered+=1,e&&(t.numCorrect+=1),updateQuizScores(quizCurrScore,quizCurrQuestion,t)}async function checkQuizStatus(e,t,i,u){1==e.numAnswered&&utilMethods.visibilityToggle(!0,t),e.numAnswered>=e.numQuestions&&(10==e.numCorrect?(await updateBadgeStatus("quiz",state.activeDifficulty,!0),await animateBadge()):quizShowScore(),await utilMethods.delay(1200),utilMethods.visibilityToggle(!1,t),utilMethods.visibilityToggle(!0,i),finishQuiz(u,e))}async function finishQuiz(e,t){e.innerHTML=t.numCorrect,resetQuizProperty(t),utilMethods.showHide([],[quizCorrectness]),questionLogic.newQuestion("quiz",state.activeOperators,state)}function quizUpdateAnswerHandler(e){e=e.target.value;state.userValue=e}function quizAnswerHandler(e){quizAnswerCheck(utilMethods.calculation(quizNumOne.innerHTML,quizNumTwo.innerHTML,quizOpOne.innerHTML)==state.userValue),e.preventDefault()}quizAnswerInput.addEventListener("input",quizUpdateAnswerHandler),quizAnswerForm.addEventListener("submit",quizAnswerHandler),window.onload=function(){var e=utilMethods.convertStringToArray(sessionStorage.getItem("activeOperators"));state.activeOperators=e,questionLogic.newQuestion("quiz",e,state)};