import*as utilMethods from"../utils.js";import{state}from"../state.js";import*as questionLogic from"../sharedQuestionLogic.js";import{updateBadgeStatus}from"../badges.js";import{animateBadge}from"../badgeEarned.js";import{quizAmountCorrect,quizAmountCorrectPercentage,quizAnswerForm,quizAnswerInput,quizCorrectness,quizCurrQuestion,quizCurrScore,quizCurrScoreContainer,quizLastScore,quizLastScoreContainer,quizModal,quizElements}from"../domElements.js";const{numOne:quizNumOne,numTwo:quizNumTwo,opOne:quizOpOne}=quizElements;async function quizAnswerCheck(e){var t=sessionStorage.getItem("activeOperators");e?(utilMethods.emphasize(quizAnswerForm,50,1.1,150),utilMethods.correctnessView(!0,quizCorrectness)):(utilMethods.incorrectMotion(quizAnswerForm),utilMethods.correctnessView(!1,quizCorrectness)),utilMethods.disableInput(quizAnswerInput),addToQuizProperty(e,state.quizStats),checkQuizStatus(state.quizStats,quizCurrScoreContainer,quizLastScoreContainer,quizLastScore),await utilMethods.delay(700),utilMethods.enableInput(quizAnswerInput),utilMethods.resetAnswerInput([quizAnswerInput]),t?questionLogic.newQuestion("quiz",t):console.log("operator value not retrieved from sessionStorage")}async function quizShowScore(){quizAmountCorrect&&quizAmountCorrectPercentage&&quizModal&&quizAnswerInput&&(quizAmountCorrect.textContent=state.quizStats.numCorrect.toString(),quizAmountCorrectPercentage.textContent=utilMethods.percentage(state.quizStats.numCorrect,state.quizStats.numAnswered).toString()+"%",quizModal.style.visibility="visible",quizModal.style.zIndex="101",utilMethods.emphasize(quizModal),await utilMethods.delay(1600),quizModal.style.visibility="hidden",quizModal.style.zIndex="0",utilMethods.enableInput(quizAnswerInput))}function resetQuizProperty(e){e.numAnswered=0,e.numCorrect=0}function updateQuizScores(e,t,i){e.innerHTML=i.numCorrect.toString(),t.innerHTML=i.numAnswered.toString()}function addToQuizProperty(e,t){t.numAnswered+=1,e&&(t.numCorrect+=1),updateQuizScores(quizCurrScore,quizCurrQuestion,t)}async function checkQuizStatus(e,t,i,r){if(1==e.numAnswered&&utilMethods.visibilityToggle(!0,t),e.numAnswered>=e.numQuestions){if(10==e.numCorrect){var n=sessionStorage.getItem("activeDifficulty"),o=sessionStorage.getItem("activeOperators");if(await animateBadge(),!n||!o)throw new Error("Session storage operator and difficulty not retrieved");await updateBadgeStatus("quiz",n,o,!0)}else quizShowScore();await utilMethods.delay(1200),utilMethods.visibilityToggle(!1,t),utilMethods.visibilityToggle(!0,i),finishQuiz(r,e)}}async function finishQuiz(e,t){e.innerHTML=t.numCorrect.toString(),resetQuizProperty(t),utilMethods.showHide([],[quizCorrectness]);e=sessionStorage.getItem("activeOperators");if(!e)throw new Error("Session storage operator not retrieved");questionLogic.newQuestion("quiz",e)}function quizUpdateAnswerHandler(e){e.target instanceof HTMLInputElement&&(e=parseInt(e.target.value,10),state.userValue=e)}function quizAnswerHandler(e){quizAnswerCheck(utilMethods.calculation(parseInt(quizNumOne.innerHTML),parseInt(quizNumTwo.innerHTML),quizOpOne.innerHTML)==state.userValue),e.preventDefault()}quizAnswerInput&&quizAnswerInput.addEventListener("input",quizUpdateAnswerHandler),quizAnswerForm&&quizAnswerForm.addEventListener("submit",quizAnswerHandler),window.onload=function(){var e=sessionStorage.getItem("activeOperators"),t=sessionStorage.getItem("activeDifficulty");if(!e||!t)throw new Error("Session storage not retrieved");utilMethods.updateGeneralSelected(e,t),questionLogic.newQuestion("quiz",e)};